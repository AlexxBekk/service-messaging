# **Задание: Чат с тремя сервисами (Redux Toolkit + Express)**

## **Описание**
Ты создашь приложение, в котором можно общаться с тремя разными сервисами:
- **Почта** (Post)
- **Продуктовый рынок** (Food Market)
- **Арендодатель** (Landlord)

Каждое сообщение будет отправляться на сервер через **Redux Toolkit Thunk**, а сервер (**Express**) будет случайным образом отвечать одним из заранее заданных сообщений.

---

## **Цели задания**
### **Фронтенд (React + Redux Toolkit)**
1. **Создать три чата** (по одному для каждого сервиса):
   - Поле ввода сообщения.
   - Кнопка "Отправить".
   - Отображение сообщений (как отправленных, так и полученных).

2. **Настроить Redux Toolkit:**
   - Использовать Redux Toolkit для хранения истории сообщений.
   - Использовать **Redux Thunk** для асинхронной отправки запросов на сервер.

3. **Обрабатывать статусы Thunk:**
   - `pending` → показывать "Печатает...".
   - `fulfilled` → отображать ответ.
   - `rejected` → показывать ошибку.

---

### **Бэкенд (Express)**
1. **Создать API `/api/message`**:
   - Принимает `{ service, message }`.
   - Логирует полученное сообщение в консоли.
   - Выбирает случайный ответ для указанного сервиса.
   - Отправляет ответ обратно.
   
2. **Настроить случайные ответы:**
   - **Почта:**
     - "Доставка задерживается из-за погоды."
     - "Адрес не найден в системе."
     - "Доставка живых тигров доступна только премиум-пользователям."
   - **Продуктовый рынок:**
     - "Ваш заказ будет готов через 10 минут!"
     - "В данный момент нет свободных курьеров."
     - "Свежих овощей сегодня нет."
   - **Арендодатель:**
     - "Оплата аренды подтверждена!"
     - "Заявка на ремонт принята."
     - "Дом будет снесен через 15 минут, успейте собраться!"

   **Дополнительно:** Один из случайных ответов сервера должен имитировать ошибку (`rejected`), например, "Ошибка сервера, попробуйте позже". Это позволит потренироваться в обработке ошибок. Чтобы отправить статус ошибки, можно использовать следующий код в `Express`:
   
   ```javascript
   res.status(500).json({ error: "Ошибка сервера, попробуйте позже" });
   ```
   **Важно**: Axios автоматически выбрасывает ошибку, если сервер возвращает HTTP-код 5xx. В этом случае catch-блок в try-catch внутри thunk обработает ошибку и передаст ее в rejected. Это ожидаемое поведение, и его нужно учитывать при обработке запросов.
---

## **Что стоит прочитать перед началом**
### **1. Redux Toolkit и Thunks**
Redux Toolkit облегчает управление состоянием, а Thunk позволяет работать с асинхронными запросами (например, запросами к серверу). 

**Как работают Thunks?**
Thunk — это специальная middleware-функция в Redux, которая позволяет создавать асинхронные экшены. Когда ты отправляешь `dispatch(someThunk())`, Redux Toolkit автоматически обрабатывает три состояния запроса:

- **`pending`** → запрос отправляется, можно показать индикатор загрузки, например, текст "Печатает..." или спиннер в UI. Это состояние наступает сразу после отправки запроса.
- **`fulfilled`** → запрос успешно выполнен, ответ сервера записывается в store. В этот момент в чате появляется как отправленное сообщение, так и ответ от сервиса.
- **`rejected`** → запрос не удался (например, сервер недоступен). В этом случае стоит обновить состояние ошибки и показать пользователю уведомление о сбое отправки.

**Как подключаются `extraReducers`?**
В `createSlice` есть возможность обрабатывать асинхронные экшены через `extraReducers`. Это позволяет подписываться на результат выполнения `createAsyncThunk`, изменяя состояние Redux-хранилища в зависимости от `pending`, `fulfilled` и `rejected`. Подробнее можно прочитать в [документации Redux Toolkit](https://redux-toolkit.js.org/api/createSlice#extrareducers).

```javascript
extraReducers: (builder) => {
  builder.addCase(sendMessage.fulfilled, (state, action) => {
    state.status = 'succeeded';
    state.chats[action.payload.service].push({
      message: action.payload.message,
      reply: action.payload.reply,
    });
  });
}
```
**Важно:** Все запросы, отправляемые через `axios` внутри thunk, лучше всего обернуть в `try-catch`, чтобы корректно обработать возможные ошибки и не ломать приложение при сбоях сети или сервера.

### **2. Axios для запросов**
Axios – это библиотека для отправки HTTP-запросов в React.
- [Документация Axios](https://axios-http.com/docs/intro)

### **3. Express.js для бэкенда**
Express – это минималистичный фреймворк для создания серверов на Node.js.
- [Официальная документация Express](https://expressjs.com/ru/)
- [Начало работы с Express](https://metanit.com/web/nodejs/4.1.php)

---

## **Важно!**

Не обязательно вкапываться в суть устройства `createAsyncThunk`, надо только понять как им пользоваться, потому что в следующем задании мы будем разбирать middleware, и ты увидишь, как это работает внутри.
